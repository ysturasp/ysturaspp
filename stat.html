<!DOCTYPE html>
<html lang="ru" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Узнайте статистику оценок студентов ЯГТУ, средние баллы и распределение оценок по различным дисциплинам. ysturasp">
    <title>ystuRASP. Оценки студентов ЯГТУ</title>
    <link rel="icon" href="images/favicon.png" type="image/png">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script defer data-domain="ysturasp.me" src="https://plausible.io/js/script.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        main {
            flex: 1;
        }
        footer {
            background-color: #1e293b;
            padding: 20px;
            text-align: center;
            color: #fff;
        }
        .dark .bg-slate-800 {
            background-color: #1e293b;
        }

        .dark .text-white {
            color: #ffffff;
        }

        .dark .text-slate-400 {
            color: #94a3b8;
        }

        .bg-slate-900 {
            background-color: #111827;
        }

        .hover\\:bg-blue-700:hover {
            background-color: #1e40af;
        }

        .transition-all {
            transition: all 0.3s ease;
        }
        
        .icon-square {
            width: 70px;
            height: 70px;
            margin-right: 0 auto;
            vertical-align: middle;
        }
        .loading-indicator {
            width: 320px;
            height: 320px;
            background: url('https://avatars.dzeninfra.ru/get-zen_doc/271828/pub_6631fab38bcdab100e7c214e_6634a992a228f13b4de1505c/orig') no-repeat center center;
            background-size: cover;
            border-radius: 50%;
        }
        .loading-text {
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #1e293bc4;
            border-radius: 5px;
            color: #fff;
            font-size: 1.2em;
            text-align: center;
        }
        .loading-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            z-index: 10000;
            position: relative;
        }
        .loading-overlay {
            z-index: 10000;
        }
        .fixed.ml-4.bottom-4.right-4 {
            position: fixed;
            bottom: 14px;
            right: 14px;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            z-index: 50;
        }
        .bg-gray-800.text-white.px-4.py-2.rounded-lg.shadow-md {
            font-size: 13px;
            background-color: #020d1f97;
            color: #ffffff;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: bottom 0.3s ease;
            width: 375px;
        }
        #cookie-notification-1, #cookie-notification-2 {
            border: 1px solid #ffffff;
            background-color: rgba(2, 13, 31, 0.6);
            margin-bottom: 0px;
            border-radius: 8px; 
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
        }
        #cookie-notification-1 p,
        #cookie-notification-2 p {
            color: white;
            font-size: 16px;
        }
        #cookie-notification-1 button,
        #cookie-notification-2 button {
            background-color: #1a73e8;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 14px;
            cursor: pointer;
            border-radius: 4px;
        }
        #cookie-notification-1 button:hover,
        #cookie-notification-2 button:hover {
            background-color: #0d47a1;
        }
        .card {
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.3);
        }
        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }
        .fade-out {
            animation: fadeOut 1s forwards;
        }
        .clear-button {
            display: none;
            position: absolute;
            padding-left: 7px;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            border: none;
            color: gray;
            font-size: 2rem;
            cursor: pointer;
            z-index: 9999;
        }

        .relative input:not(:placeholder-shown) + .clear-button {
            display: block;
        }
        .ambient-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(30, 30, 30, 0.7);
            z-index: 9998;
            backdrop-filter: blur(1px);
            -webkit-backdrop-filter: blur(1px);
            pointer-events: none;
        }
        .ambient-focuss {
            position: relative;
            padding: 20px;
            border-radius: 10px;
            background: rgba(1, 21, 51, 0.931);
            box-shadow: 0 0 200px rgb(0, 57, 117);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            z-index: 9999;
        }
        .ambient-focus {
            padding: 20px;
            border-radius: 10px;
            background: rgba(1, 21, 51, 0.931);
            box-shadow: 0 0 200px rgb(0, 57, 117);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            z-index: 9999;
        }
        .relative .combobox-options {
            backdrop-filter: none;
            -webkit-backdrop-filter: none;
            z-index: 10000;
        }
        input {
            transition: all 0.4s ease-in-out;
        }

        input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 8px rgba(59, 130, 246, 0.8);
        }
        .ambient-overlay {
            transition: backdrop-filter 0.6s ease-in-out, background 0.6s ease-in-out;
        }
        .ambient-focus {
            transition: box-shadow 0.6s ease-in-out, backdrop-filter 0.6s ease-in-out;
        }
        .combobox-options {
            max-height: 300px;
            overflow-y: auto; 
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 0.8s ease, transform 0.8s ease;
            max-height: 0;
            overflow: scroll;
        }
        .combobox-options.active {
            opacity: 1;
            transform: translateY(0);
            max-height: 300px;
        }
        .combobox-options li {
            border-radius: 10px;
            transition: background-color 0.3s ease-in-out;
        }
        .combobox-options li:hover {
            border-radius: 10px;
            background-color: #0072e461;
        }
        @keyframes fadeInScale {
            0% {
                transform: translateY(-30%) scale(0.8);
                opacity: 0;
            }
            100% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }
        @keyframes fadeOutScale {
            0% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateY(-30%) scale(0.8);
                opacity: 0;
            }
        }
        #mobile-menu.show {
            display: block;
            animation: fadeInScale 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards;
        }
        #mobile-menu.hide {
            animation: fadeOutScale 0.2s ease-in forwards;
        }
    </style>
</head>
<body class="bg-slate-900 text-gray-300 antialiased">
    <header class="container mx-auto sticky top-4 px-3 z-50">
        <div style="background-color: #1e293bad; backdrop-filter: blur(4px); -webkit-backdrop-filter: blur(4px);" class="rounded-lg px-3 py-4 md:px-6 md:py-4 ring-1 ring-slate-900/5 shadow-xl flex justify-between items-center transition-all">
            <nav class="hidden md:flex gap-x-4">
                <a href="/" class="text-blue-500 font-semibold text-sm md:text-base hover:text-blue-400 transition-all">ystuRASP Главная</a>
                <a href="/stat" class="text-sm md:text-base hover:text-blue-400 transition-all">Статистика</a>
                <a href="/rasp" class="text-sm md:text-base hover:text-blue-400 transition-all">Расписание</a>
                <a href="/data" class="text-sm md:text-base hover:text-blue-400 transition-all">Экспорт/Импорт</a>
                <a href="/about" class="text-sm md:text-base hover:text-blue-400 transition-all">О нас</a>
            </nav>
            <div class="relative md:hidden">
                <button id="mobile-menu-btn" class="p-2 rounded-lg bg-slate-700 hover:bg-slate-600 transition-all">
                    <svg class="w-6 h-6 text-gray-200" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
            <div class="flex gap-x-2">
                <a href="/student" class="p-2 bg-blue-700 text-white rounded-lg text-xs md:text-sm hover:bg-blue-600 transition-all">Чатик для студентов 👋🏻</a>
            </div>
        </div>
        <div id="mobile-menu" class="md:hidden bg-slate-800 rounded-lg mt-4 px-3 py-2 md:px-6 md:py-3 ring-1 ring-slate-900/5 shadow-xl absolute top-full left-3 right-3 hidden">
            <a href="/" class="block py-2 text-blue-500 font-semibold text-sm md:text-base">ystuRASP Главная</a>
            <a href="/stat" class="block py-2 hover:text-blue-400 text-sm md:text-base">Статистика</a>
            <a href="/rasp" class="block py-2 hover:text-blue-400 text-sm md:text-base">Расписание</a>
            <a href="/data" class="block py-2 hover:text-blue-400 text-sm md:text-base">Экспорт/Импорт</a>
            <a href="/about" class="block py-2 hover:text-blue-400 text-sm md:text-base">О нас</a>
        </div>
    </header>

    <main class="container mx-auto mt-5 md:mt-7 px-3 md:px-0">
        <section class="bg-slate-800 rounded-lg p-6 mt-8">
            <h2 class="text-4xl font-semibold text-white mb-4">👨‍💻 Статистика оценок</h2>
            <div class="form-group">
                <label for="combobox-input" class="block mb-2 text-sm font-medium text-slate-400">Выберите дисциплину:</label>
                <div class="relative">
                    <input id="combobox-input" type="text" class="block w-full p-2.5 bg-slate-900 border border-gray-600 rounded-lg text-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="Выберите дисциплину...">
                    <button id="clear-button" class="clear-button">&times;</button>
                    <ul id="combobox-options" class="absolute w-full bg-slate-900 border border-gray-600 rounded-lg mt-1 overflow-hidden combobox-options">
                    </ul>
                </div>
                <button class="btn btn-primary btn-block mt-3 p-2 bg-blue-700 text-white rounded-lg hover:bg-blue-600 transition-all" onclick="getStatistics()">Получить статистику</button>
            </div>
            <div class="result mt-4" id="statisticsResult"></div>
        </section>

        <section class="bg-slate-800 rounded-lg p-6 mt-8">
            <h2 class="text-2xl font-semibold text-white mb-4">👀 Вы недавно смотрели</h2>
            <div id="recentlyViewed" class="space-y-4">
            </div>
        </section>
        
    </main>

    <div class="loading-overlay fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center hidden" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-indicator"></div>
            <div class="loading-text">Загрузка, ожидайте...</div>
        </div>
    </div>

    <footer class="bg-slate-800 py-6 mt-12">
        <div class="container mx-auto px-4">
            <div class="flex flex-wrap justify-between items-center">
                <div class="w-full md:w-1/3 text-center md:text-left">
                    <h2 class="text-white text-lg font-bold">ystuRASP</h2>
                    <p class="text-slate-400 mt-2">Анализ и статистика оценок студентов ЯГТУ</p>
                </div>
                <div class="w-full md:w-1/3 text-center mt-4 md:mt-0">
                    <nav class="flex justify-center gap-4">
                        <a href="https://t.me/ysturasp" class="text-slate-400 hover:text-white transition-all">
                            <div class="w-14 h-14 bg-white rounded p-1">
                                <img src="https://cdn-icons-png.flaticon.com/512/2111/2111646.png" alt="Telegram" class="mx-auto my-1 w-10 h-10">
                            </div>
                        </a>
                        <a href="https://boosty.to/ysturasp.me" class="text-slate-400 hover:text-white transition-all">
                            <div class="w-14 h-14 bg-white rounded p-1">
                                <img src="https://boosty.to/favicon.ico" alt="Boosty" class="mx-auto my-1 w-10 h-10">
                            </div>
                        </a>
                    </nav>
                </div>
                <div class="w-full md:w-1/3 text-center md:text-right mt-4 md:mt-0">
                    <p class="text-slate-400">© 2024 Made with ❤️ by ystuRASP</p>
                </div>
            </div>
        </div>
    </footer>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const disciplines = [
                "CRM-системы",
                "Web - технологии",
                "Администрирование информационных систем (англ.)",
                "Администрирование информационных систем (рус)",
                "Администрирование информационных систем",
                "Администрирование средств защиты информации",
                "Алгоритмизация и программирование",
                "Алгоритмы и структуры данных",
                "Анализ данных и процессов",
                "Архитектура ЭВМ",
                "Архитектура информационных систем",
                "Базы данных",
                "Безопасность жизнедеятельности",
                "Бизнес-планирование и инвестиционное проектирование",
                "Большие данные",
                "Введение в программную инженерию",
                "Введение в современные информационные технологии",
                "Введение в специальность",
                "Введение в теорию информации",
                "Вычислительные машины, системы и сети",
                "Вычислительные методы в компьютерном инжиниринге",
                "Геоинформационные системы",
                "Гидро- и пневмоприводы",
                "Деловой иностранный язык",
                "Диагностика в технических системах",
                "Дискретная и интервальная математика",
                "Дискретная математика",
                "Дискретная математика и математическая логика",
                "Защита интеллектуальной собственности",
                "Защита объектов интеллектуальной собственности",
                "Защита персональных данных",
                "Инвестиционный менеджмент",
                "Инженерная и компьютерная графика",
                "Иностранный язык",
                "Иностранный язык (специализация)",
                "Иностранный язык делового и профессионального общения",
                "Инструментальные средства информационных систем",
                "Инструменты моделирования бизнес-процессов",
                "Интегрированные производственные системы и комплексы",
                "Интегрированные системы проектирования и управления",
                "Интегрированные телекоммуникационные системы",
                "Интеллектуальные информационные системы и технологии",
                "Интеллектуальные системы диагностики технического состояния объектов",
                "Интеллектуальные системы и технологии",
                "Интернет-маркетинг",
                "Инфокоммуникационные системы и сети",
                "Информатика",
                "Информационная безопасность и защита информации",
                "Информационная безопасность интегрированных информационных систем",
                "Информационная безопасность телекоммуникационных систем и вычислительных сетей",
                "Информационные технологии",
                "Информационные технологии в научно-исследовательской и практической деятельности",
                "Информационные технологии в управлении производственными процессами",
                "Информационные технологии и программные комплексы",
                "Информационные технологии управления предприятием",
                "Искусственный интеллект и машинное обучение",
                "Исследование операций",
                "История (история России, всеобщая история)",
                "История",
                "История развития отрасли",
                "Компьютерная графика",
                "Компьютерное моделирование в экономике",
                "Компьютерные сети",
                "Компьютерные технологии вычислений в математическом моделировании",
                "Корпоративные информационные системы управления предприятием",
                "Криптографические методы защиты информации",
                "Культурология и этика общения",
                "Линейная алгебра",
                "Линейные непрерывные системы управления",
                "Логистика",
                "Маркетинг",
                "Матеpиаловедение",
                "Математика",
                "Математика (доп.главы)",
                "Математические основы интеллектуальных систем",
                "Математический анализ",
                "Материаловедение и технология конструкционных материалов",
                "Машинно-зависимые языки программирования",
                "Машинное обучение",
                "Машинное обучение и искусственный интеллект",
                "Менеджмент ИТ проектов",
                "Методология проектирования сложных систем управления",
                "Методы и модели анализа данных",
                "Методы и средства проектирования информационных систем и технологий",
                "Методы исследования и моделирования информационных процессов и технологий",
                "Метрология",
                "Метрология и измерительная техника",
                "Микропроцессорные устройства в робототехнике",
                "Микроэкономика",
                "Моделирование объектов и систем управления",
                "Моделирование производственных процессов. Моделирование основных производственных процессов",
                "Моделирование систем",
                "Моделирование систем управления",
                "Научная публицистика",
                "Научно-исследовательская работа",
                "Начертательная геометрия",
                "Начертательная геометрия, инженерная и компьютерная графика",
                "Нелинейные и цифровые системы управления",
                "Обработка изображений и компьютерное зрение",
                "Общая и неоpганическая химия",
                "Объектно-ориентированное программирование",
                "Ознакомительная практика",
                "Операционные системы",
                "Оптимальное управление",
                "Организационно-правовое обеспечение информационной безопасности",
                "Организация производства в ИТ отрасли",
                "Основы Web безопасности",
                "Основы инженерного проектирования",
                "Основы менеджмента",
                "Основы построения защищенных баз данных",
                "Основы построения защищенных компьютерных сетей",
                "Основы программирования",
                "Основы программирования на Python",
                "Основы проектирования интерфейсов",
                "Основы современного естествознания",
                "Основы теории принятия решений",
                "Основы цифровой техники",
                "Поддержка и предоставление IT- сервисов",
                "Подтверждение соответствия: сертификация средств защиты информации",
                "Правоведение",
                "Практика производственная (научно-исследовательская работа)",
                "Практика производственная (практика по получению профессиональных умений и опыта профессиональной деятельности)",
                "Практика производственная (практика по получению профессиональных умений и опыта профессиональной деятельности: технологическая практика)",
                "Практика производственная (проектно-технологическая)",
                "Практика производственная преддипломная",
                "Практика производственная технологическая (пректно-технологическая)",
                "Практика производственная технологическая (проектно-технологическая)",
                "Практика учебная (ознакомительная)",
                "Практика учебная (педагогическая)",
                "Практика учебная (практика по получению первичных профессиональных умений и навыков)",
                "Практика учебная (практика по получению первичных профессиональных умений и навыков, в т.ч. первичных умений и навыков научно-исследовательской деятельности)",
                "Практика учебная (практика по получению первичных профессиональных умений и навыков, в том числе первичных умений и навыков научно-исследовательской деятельности)",
                "Практика учебная (технологическая)",
                "Практика учебная",
                "Предиктивная аналитика",
                "Представление знаний и экспертные системы",
                "Прикладная механика",
                "Прикладная физическая культура (элективные дисциплины)",
                "Прикладные решения 1С",
                "Программирование",
                "Программирование для мобильных платформ",
                "Программирование и основы алгоритмизации",
                "Программирование промышленных контроллеров",
                "Программная реализация систем искусственного интеллекта",
                "Программно-аппаратные средства защиты информации",
                "Проектирование распределенных систем хранения и обработки информации",
                "Проектирование систем автоматизации",
                "Проектная деятельность",
                "Проектное обучение технологическому предпринимательству",
                "Проектный практикум",
                "Производственная практика",
                "Системная инженерия",
                "Системы интеллектуальной обработки \"больших\" данных",
                "Системы менеджмента информационной безопасности",
                "Системы поддержки принятия решений",
                "Системы управления базами данных",
                "Современные информационные технологии",
                "Современные телекоммуникационные системы",
                "Современные технологии разработки мобильных приложений",
                "Специальные главы математики",
                "Средства анализа безопасности программного обеспечения",
                "Статистические методы анализа данных",
                "Сценарные языки программирования",
                "Телекоммуникационные системы",
                "Теоpетическая механика",
                "Теоретические и экспериментальные методы научных исследований",
                "Теория автоматического управления",
                "Теория вероятностей и математическая статистика",
                "Теория информационных процессов и систем",
                "Теория систем и системный анализ",
                "Тестирование и отладка программного обеспечения",
                "Технико-экономическое обоснование и управление проектами",
                "Техническая механика",
                "Технические измерения и приборы",
                "Технические средства автоматизации и управления",
                "Технологии интернета вещей",
                "Технологии обработки информации",
                "Технологии программирования",
                "Технологии разработки программного обеспечения",
                "Технологические процессы и оборудование",
                "Технологические процессы и производства",
                "Типовые автоматические системы регулирования",
                "Типовые системы управления в робототехнике",
                "Управление ИТ проектами",
                "Управление данными",
                "Управление качеством",
                "Управление машиностроительными процессами",
                "Управление организацией в цифровой экономике",
                "Управление проектами разработки программного обеспечения",
                "Управление производственными процессами",
                "Учебная практика",
                "Физика",
                "Физика. Основы квантовой физики",
                "Физическая культура и спорт",
                "Философия",
                "Философские проблемы науки и техники",
                "Химия",
                "Цифровая культура",
                "Цифровая экономика и сквозные технологии",
                "Экономика",
                "Экономика IT-отрасли",
                "Экономика ИТ-отрасли",
                "Экономика и организация производства",
                "Экономическая теория",
                "Экспертные системы",
                "Электромагнитные поля и волны в современных телекоммуникациях",
                "Электроника и схемотехника",
                "Электронная коммерция",
                "Электротехника",
                "Электротехника и электроника",
                "Экономика и организация производства",
                "Экспертные системы",
                "Электромагнитные поля и волны в современных телекоммуникациях",
                "Электроника и схемотехника",
                "Электронная коммерция",
                "Электротехника",
                "Электротехника и электроника"
            ];

            const inputElement = document.getElementById('combobox-input');
            const optionsElement = document.getElementById('combobox-options');
            const clearButton = document.getElementById('clear-button');
            const overlay = document.createElement('div');
            overlay.classList.add('ambient-overlay', 'hidden');
            document.body.appendChild(overlay);
            const inputField = document.getElementById('combobox-input');

            inputField.addEventListener('focus', () => {
                setTimeout(() => {
                    window.scrollTo({
                        top: inputField.getBoundingClientRect().top + window.pageYOffset - 28, 
                        behavior: 'smooth'
                    });
                }, 300);
            });

            function updateOptions(query = '') {
                optionsElement.innerHTML = '';

                const filteredDisciplines = disciplines.filter(discipline => discipline.toLowerCase().includes(query.toLowerCase()));
                filteredDisciplines.forEach(discipline => {
                    const optionElement = document.createElement('li');
                    optionElement.textContent = discipline;
                    optionElement.classList.add('p-2', 'cursor-pointer', 'hover:bg-gray-700');
                    optionElement.addEventListener('mousedown', function () {
                        inputElement.value = discipline;
                        optionsElement.classList.remove('active');
                        clearButton.style.display = 'block';
                    });
                    optionsElement.appendChild(optionElement);
                });
            }

            inputElement.addEventListener('focus', function () {
                overlay.classList.remove('hidden');
                inputElement.classList.add('ambient-focuss');
                optionsElement.classList.add('ambient-focus');
                optionsElement.classList.add('active');
                updateOptions(this.value);
            });

            inputElement.addEventListener('input', function () {
                updateOptions(this.value);
                if (this.value === '') {
                    clearButton.style.display = 'none';
                } else {
                    clearButton.style.display = 'block';
                }
            });

            inputElement.addEventListener('click', function (event) {
                event.stopPropagation();
                optionsElement.classList.add('active');
                updateOptions(this.value);
            });

            document.addEventListener('click', function (event) {
                if (!inputElement.contains(event.target) && !optionsElement.contains(event.target)) {
                    optionsElement.classList.remove('active');
                    overlay.classList.add('hidden');
                    inputElement.classList.remove('ambient-focuss');
                    optionsElement.classList.remove('ambient-focus');
                }
            });

            document.querySelector('#combobox-options').addEventListener('click', function() {
                document.querySelector('.ambient-overlay').style.display = 'none';
            });

            clearButton.addEventListener('click', function () {
                inputElement.value = '';
                optionsElement.classList.remove('active');
                clearButton.style.display = 'none';
            });

            updateOptions();
            checkUrlParameters();
        });

        function addToRecentlyViewed(discipline, stats) {
            let recentlyViewed = JSON.parse(localStorage.getItem('recentlyViewed')) || [];

            recentlyViewed = recentlyViewed.filter(item => item.discipline !== discipline);

            recentlyViewed.unshift({ discipline, stats });

            if (recentlyViewed.length > 5) {
                recentlyViewed.pop();
            }

            localStorage.setItem('recentlyViewed', JSON.stringify(recentlyViewed));
            displayRecentlyViewed();
        }

        function displayRecentlyViewed() {
            const recentlyViewed = JSON.parse(localStorage.getItem('recentlyViewed')) || [];
            const container = document.getElementById('recentlyViewed');
            container.innerHTML = '';

            recentlyViewed.forEach(item => {
                const { discipline, stats } = item;
                
                const average = stats.average.toFixed(2);
                const totalCount = stats.count5 + stats.count4 + stats.count3 + stats.count2;

                const element = document.createElement('div');
                element.className = 'rounded-lg bg-slate-700 text-white';

                element.innerHTML = `
                    <div class="flex p-4 bg-gray-700 rounded-lg justify-between items-center">
                        <div>
                            <h3 class="text-sm md:text:xl font-bold">${discipline}</h3>
                            <p>Средний балл: ${average}</p>
                            <p>Оценок: ${totalCount}</p>
                        </div>
                        <button class="bg-blue-700 text-white px-3 py-1 rounded hover:bg-blue-600" onclick="viewAgain('${discipline}')">Посмотреть снова</button>
                    </div>
                `;

                container.appendChild(element);
            });
        }

        function viewAgain(discipline) {
            const inputElement = document.getElementById('combobox-input');
            inputElement.value = discipline;
            getStatistics();
        }

        document.addEventListener('DOMContentLoaded', displayRecentlyViewed);

        async function getStatistics() {
            const disciplineSelect = document.getElementById('combobox-input');
            const discipline = disciplineSelect.value;
            const cachedData = localStorage.getItem(discipline);

            const loadingOverlay = document.getElementById('loadingOverlay');
            loadingOverlay.classList.remove('hidden');

            if (cachedData) {
                const data = JSON.parse(cachedData);
                displayStatistics(data);
                addToRecentlyViewed(discipline, data);
                loadingOverlay.classList.add('hidden');
            } else {
                const url = `https://script.google.com/macros/s/AKfycbxdL_UC__SmYJiPHmlsD4-T1ZiglPvgnehXed1OR9Qjk_fJ3rPxrVBT5Z0Zh1CiI7sC/exec?discipline=${encodeURIComponent(discipline)}`;

                try {
                    const response = await fetch(url);
                    const data = await response.json();
                    localStorage.setItem(discipline, JSON.stringify(data));
                    displayStatistics(data);
                    addToRecentlyViewed(discipline, data);
                } catch (error) {
                    console.error('Ошибка при получении данных:', error);
                    displayError('Ошибка при получении данных');
                } finally {
                    loadingOverlay.classList.add('hidden');
                }
            }
        }

        function displayStatistics(data) {
            const disciplineSelect = document.getElementById('combobox-input');
            const discipline = disciplineSelect.value;
            const resultDiv = document.getElementById('statisticsResult');

            if (data.error) {
                resultDiv.innerHTML = `<p>${data.error}</p>`;
                return;
            }

            const { average, count5, count4, count3, count2 } = data;
            const totalCount = count5 + count4 + count3 + count2;

            let emoji = average >= 4 ? "😍" : "😭";
            let warningMessage = totalCount < 25 ? "<div class='bg-red-500 text-white font-bold p-2 rounded-lg mb-4'>⚠️⚠️⚠️ Данных недостаточно, статистика может быть неточна ⚠️⚠️⚠️</div>" : "";

            const statisticsHTML = `
                <div style="text-align: center;">
                    <h3 class="text-2xl md:text-3xl font-bold mb-4">Статистика по предмету "${discipline}"</h3>
                </div>
                ${warningMessage}
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="rounded-lg p-4 text-center" style="border: 3px solid #f8fafc;">
                        <h2 class="text-2xl font-bold mb-2">Средний балл ${emoji}</h2>
                        <p class="text-slate-300 text-2xl">${average}</p>
                    </div>
                    <div class="rounded-lg p-4 text-center" style="border: 3px solid #f8fafc;">
                        <h2 class="text-2xl font-bold mb-2">Всего оценок проанализировано</h2>
                        <p class="text-slate-300 text-2xl">${totalCount}</p>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-4">
                    <div class="rounded-lg p-4 text-center" style="border: 3px solid #f8fafc;">
                        <h3 class="text-xl font-bold mb-2">Пятерок</h3>
                        <p class="text-slate-300 text-2xl">${count5}</p>
                    </div>
                    <div class="rounded-lg p-4 text-center" style="border: 3px solid #f8fafc;">
                        <h3 class="text-xl font-bold mb-2">Четверок</h3>
                        <p class="text-slate-300 text-2xl">${count4}</p>
                    </div>
                    <div class="rounded-lg p-4 text-center" style="border: 3px solid #f8fafc;">
                        <h3 class="text-xl font-bold mb-2">Троек</h3>
                        <p class="text-slate-300 text-2xl">${count3}</p>
                    </div>
                    <div class="rounded-lg p-4 text-center" style="border: 3px solid #f8fafc;">
                        <h3 class="text-xl font-bold mb-2">Двоек</h3>
                        <p class="text-slate-300 text-2xl">${count2}</p>
                    </div>
                </div>
                <div class="mt-8">
                    <canvas id="gradesChart" style="width: 400px; height: 200px;"></canvas>
                </div>
            `;

            resultDiv.innerHTML = statisticsHTML;

            const ctx = document.getElementById('gradesChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Пятерки', 'Четверки', 'Тройки', 'Двойки'],
                    datasets: [{
                        label: 'Количество оценок',
                        data: [count5, count4, count3, count2],
                        backgroundColor: ['#4caf50', '#2196f3', '#ffeb3b', '#f44336'],
                        borderColor: ['#388e3c', '#1976d2', '#fbc02d', '#d32f2f'],
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function displayError(message) {
            const resultDiv = document.getElementById('statisticsResult');
            resultDiv.innerHTML = `<p class="text-red-500">${message}</p>`;
        }

        const mobileMenuButton = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');

        mobileMenuButton.addEventListener('click', function() {
            if (mobileMenu.classList.contains('hide') || mobileMenu.classList.contains('hidden')) {
                mobileMenu.classList.remove('hidden', 'hide');
                mobileMenu.classList.add('show');
            } else {
                mobileMenu.classList.remove('show');
                mobileMenu.classList.add('hide');
                
                mobileMenu.addEventListener('animationend', () => {
                    if (mobileMenu.classList.contains('hide')) {
                        mobileMenu.classList.add('hidden');
                    }
                }, { once: true });
            }
        });

        document.addEventListener('click', function(event) {
            if (!mobileMenu.contains(event.target) && !mobileMenuButton.contains(event.target)) {
                mobileMenu.classList.remove('show');
                mobileMenu.classList.add('hide');
                
                mobileMenu.addEventListener('animationend', () => {
                    if (mobileMenu.classList.contains('hide')) {
                        mobileMenu.classList.add('hidden');
                    }
                }, { once: true });
            }
        });

        mobileMenu.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', function() {
                mobileMenu.classList.remove('show');
                mobileMenu.classList.add('hide');
                
                mobileMenu.addEventListener('animationend', () => {
                    if (mobileMenu.classList.contains('hide')) {
                        mobileMenu.classList.add('hidden');
                    }
                }, { once: true });
            });
        });

        function checkUrlParameters() {
            const urlParams = new URLSearchParams(window.location.search);
            const subject = urlParams.get('subject');
            if (subject) {
                const disciplineSelect = document.getElementById('combobox-input');
                disciplineSelect.value = subject;
                getStatistics();
            }
        }
    </script>
    <!-- Yandex.Metrika counter -->
    <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();
    for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
    k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(97705826, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true,
        webvisor:true
    });
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/97705826" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-0K2G90RDS0"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-0K2G90RDS0');
    </script>
    <!-- Google tag (gtag.js) -->
</body>
</html>
